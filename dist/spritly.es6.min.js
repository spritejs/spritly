module.exports=function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=18)}([function(t,e){t.exports=require("Blockly")},function(t,e,n){const i=n(0),{Msg:o}=i;o.SPRITE_HUE=330,o.ATTRS_HUE=130,o.ATTRS_SPRITE_HUE=140,o.ATTRS_LABEL_HUE=150,o.ATTRS_PATH_HUE=160,o.EASING_HUE=90,o.ANIMATE_HUE=345,o.SIGNALS_HUE=55,o.LITERAL_HUE=250,o.GETTER_SETTER_HUE=120,o.STORE_HUE=70,o.FLOWS_HUE=220,o.MATH_HUE=270,o.LOG_HUE=310,o.SOUND_HUE=45,o.PROCEDURE_HUE=290},function(t,e,n){const i=n(0),{Msg:o}=i;o.COMMON_FGLAYER="前景图层",o.COMMON_BGLAYER="背景图层",o.COMMON_TARGET="目标元素",o.COMMON_SENDER="发送者",o.COMMON_RECEIVER="接收者",o.COMMON_SPRITE="精灵元素",o.COMMON_LABEL="文本元素",o.COMMON_PATH="矢量元素",o.CATEGORY_SIGNALS="信号",o.CATEGORY_PROCEDURE="过程",o.CATEGORY_SPRITES="元素对象",o.CATEGORY_ATTRIBUTES="元素属性",o.CATEGORY_ATTRIBUTES_COMMON="公共属性",o.CATEGORY_ATTRIBUTES_SPRITE="精灵属性",o.CATEGORY_ATTRIBUTES_LABEL="文本属性",o.CATEGORY_ATTRIBUTES_PATH="矢量属性",o.CATEGORY_ANIM_ASYNC="动画和异步",o.CATEGORY_GETTER_SETTER="属性读写",o.CATEGORY_STORE="共享数据",o.CATEGORY_LITERALS="字面量",o.CATEGORY_LISTS="列表对象",o.CATEGORY_MATH="数学计算",o.CATEGORY_LOGIC="逻辑判断",o.CATEGORY_FLOWS="循环和条件",o.CATEGORY_LOG="日志输出",o.CATEGORY_SOUND="音效",o.SENDER_RECEIVER_TARGET_TOOLTIP="发送者：发送信号的元素。\n接收者：接收信号的元素。\n目标元素：如果信号由事件触发，目标元素是实际事件目标。",o.FGLAYER_BGLAYER_TOOTIP="前景图层接收DOM事件，\n背景图层不接收DOM事件。",o.LITERAL_NULL="空",o.LITERAL_UNDEFINED="未定义",o.NIL_TOOLTIP="%1值。",o.OBJECT_CREATE_TOOLTIP="构造一个对象。",o.LOOP_GET_INDEX_MSG0="索引值",o.LOOP_GET_INDEX_TOOLTIP="循环中的索引值。",o.ATTR_ID="ID",o.ATTR_NAME="名字",o.ATTR_ANCHORX="X向锚",o.ATTR_ANCHORY="Y向锚",o.ATTR_X="X坐标",o.ATTR_Y="Y坐标",o.ATTR_WIDTH="宽",o.ATTR_HEIGHT="高",o.ATTR_BGCOLOR="背景色",o.ATTR_OPACITY="透明度",o.ATTR_SCALEX="X向拉伸",o.ATTR_SCALEY="Y向拉伸",o.ATTR_TRANSLATEX="X向平移",o.ATTR_TRANSLATEY="Y向平移",o.ATTR_SKEWX="X向扭曲",o.ATTR_SKEWY="Y向扭曲",o.ATTR_ROTATE="逆时针旋转",o.ATTR_BORDERRADIUS="圆角半径",o.ATTR_BORDERWIDTH="边框线宽",o.ATTR_BORDERSTYLE="边框样式",o.ATTR_BORDERCOLOR="边框颜色",o.ATTR_DASHOFFSET="虚线框偏移",o.ATTR_TEXTURE="图片纹理",o.ATTR_TEXT="文本",o.ATTR_FONTSIZE="字号",o.ATTR_FONTFAMILY="字体",o.ATTR_FONTSTYLE="字体样式",o.ATTR_FONTVARIANT="字体变体",o.ATTR_FONTWEIGHT="字体粗细",o.ATTR_TEXTALIGN="文本对齐",o.ATTR_LINEHEIGHT="文本行高",o.ATTR_D="SVG路径",o.ATTR_LINEWIDTH="路径线宽",o.ATTR_LINEDASH="路径虚线样式",o.ATTR_LINEDASHOFFSET="路径虚线偏移",o.ATTR_LINECAP="线帽样式",o.ATTR_LINEJOIN="连线样式",o.ATTR_BOUNDING="碰撞边界",o.ATTR_STROKECOLOR="描线颜色",o.ATTR_FILLCOLOR="填充颜色",o.ATTR_CURSOR="鼠标样式",o.ATTR_DRAGGABLE="可拖拽？",o.ATTR_VALUE_YES="是",o.ATTR_VALUE_NO="否",o.ATTR_VALUE_SOLID="实线",o.ATTR_VALUE_DASHED="虚线",o.ATTR_VALUE_NORMAL="常规",o.ATTR_VALUE_BOLD="粗体",o.ATTR_VALUE_LIGHTER="细体",o.ATTR_VALUE_ITALIC="斜体",o.ATTR_VALUE_OBLIQUE="倾斜",o["ATTR_VALUE_SMALL-CAPS"]="小型大写",o.ATTR_VALUE_LEFT="靠左",o.ATTR_VALUE_RIGHT="靠右",o.ATTR_VALUE_CENTER="居中",o.ATTR_VALUE_BUTT="平直",o.ATTR_VALUE_ROUND="圆形",o.ATTR_VALUE_SQUARE="方形",o.ATTR_VALUE_MITER="尖角",o.ATTR_VALUE_BEVEL="斜角",o.ATTR_VALUE_BOX="基于盒子",o.ATTR_VALUE_PATH="基于路径",o.ATTR_VALUE_DEFAULT="默认",o.ATTR_VALUE_CROSSHAIR="十字线",o.ATTR_VALUE_POINTER="手形",o.ATTR_VALUE_MOVE="可被移动",o["ATTR_VALUE_E-RESIZE"]="可右移",o["ATTR_VALUE_NE-RESIZE"]="可右上移",o["ATTR_VALUE_SE-RESIZE"]="可右下移",o["ATTR_VALUE_W-RESIZE"]="可左移",o["ATTR_VALUE_NW-RESIZE"]="可左上移",o["ATTR_VALUE_SW-RESIZE"]="可左下移",o["ATTR_VALUE_N-RESIZE"]="可上移",o["ATTR_VALUE_S-RESIZE"]="可下移",o.ATTR_VALUE_TEXT="文本",o.ATTR_VALUE_WAIT="等待",o.ATTR_VALUE_HELP="帮助",o.AWAIT_MSG0="等待 %1 毫秒 🕙",o.AWAIT_TOOLTIP="等待 %1 毫秒后继续执行后续操作。",o.AWAIT_FRAME_MSG0="等待 %1 更新到下一帧 ⌛",o.AWAIT_FRAME_TOOLTIP="等待图层更新后继续执行后续操作。",o.SPRITE_ANIMATE_MSG0="%1 %2 动画持续 %3 秒",o.SPRITE_ANIMATE_MSG1="起始状态 %1",o.SPRITE_ANIMATE_MSG2="结束状态 %1",o.SPRITE_ANIMATE_MSG3="缓动策略 %1",o.SPRITE_ANIMATE_TOOLTIP="在指定元素上执行动画操作。",o.SPRITE_ANIMATE_OPTION_ASYNC_DEFAULT="⚡️ 立即执行",o.SPRITE_ANIMATE_OPTION_ASYNC_AWAIT="⌛️ 执行并等待",o.EASING_MSG0="%1",o.EASING_OPTION_EASING_EASE="匀速",o.EASING_OPTION_EASING_EASEIN="匀加速",o.EASING_OPTION_EASING_EASEOUT="匀减速",o.EASING_OPTION_EASING_EASEINOUT="先加速后减速",o.EASING_OPTION_TOOLTIP="为动画设置缓动策略。",o.BEZIER_EASING_MSG0="贝塞尔曲线 %1 %2 %3 %4",o.BEZIER_EASING_TOOLTIP="将动画缓动策略设置为贝塞尔曲线。",o.FIELD_ATTR_INC_MSG0="%1 %2",o.FIELD_ATTR_INC_TOOLTIP="在原值基础上改变属性值。",o.KEYVALUE_MSG0="%1: %2,",o.KEYVALUE_TOOLTIP="设置“属性-值”对。",o.FIELD_ATTR_ANCHOR_TOOLTIP="设置元素的%1。",o.FIELD_ATTR_XY_TOOLTIP="设置元素的%1。",o.FIELD_ATTR_SIZE_TOOLTIP="设置元素的%1。",o.FIELD_ATTR_BGCOLOR_TOOLTIP="设置元素的背景色。",o.FIELD_ATTR_OPACITY_TOOLTIP="设置元素的透明度。",o.FIELD_ATTR_ROTATE_TOOLTIP="设置元素的逆时针旋转角度。",o.FIELD_ATTR_SCALE_TOOLTIP="设置元素的%1。",o.FIELD_ATTR_TRANSLATE_TOOLTIP="设置元素的%1。",o.FIELD_ATTR_SKEW_TOOLTIP="设置元素的%1。",o.FIELD_ATTR_BORDERRADIUS_TOOLTIP="设置元素的圆角半径。",o.FIELD_ATTR_BORDERWIDTH_TOOLTIP="设置元素的边框宽度。",o.FIELD_ATTR_BORDERSTYLE_TOOLTIP="设置元素的边框样式。",o.FIELD_ATTR_BORDERCOLOR_TOOLTIP="设置元素的边框颜色。",o.FIELD_ATTR_DASHOFFSET_TOOLTIP="如果元素边框样式为虚线，设置边框虚线的偏移量。",o.FIELD_ATTR_TEXTURE_TOOLTIP="设置精灵元素的图片纹理。",o.FIELD_ATTR_TEXT_TOOLTIP="设置文本元素的内容。",o.FIELD_ATTR_FONTSIZE_TOOLTIP="设置文本元素的字号。",o.FIELD_ATTR_FONTFAMILY_TOOLTIP="设置文本元素的字体。",o.FIELD_ATTR_FONTSTYLE_TOOLTIP="设置文本元素的字体样式。",o.FIELD_ATTR_FONTVARIANT_TOOLTIP="设置文本元素的字体变体。",o.FIELD_ATTR_FONTWEIGHT_TOOLTIP="设置文本元素的字体粗细。",o.FIELD_ATTR_TEXTALIGN_TOOLTIP="设置文本元素的文字对齐方式。",o.FIELD_ATTR_LINEHEIGHT_TOOLTIP="设置文本元素的行高。",o.FIELD_ATTR_D_TOOLTIP="设置矢量元素的SVG路径。",o.FIELD_ATTR_LINEWIDTH_TOOLTIP="设置矢量元素的线宽。",o.FIELD_ATTR_LINEDASH_TOOLTIP="将矢量元素的描线设为虚线。",o.FIELD_ATTR_LINEDASHOFFSET_TOOLTIP="如果矢量元素的描线是虚线，设置虚线偏移量。",o.FIELD_ATTR_LINECAP_TOOLTIP="设置矢量元素的线帽样式。",o.FIELD_ATTR_LINEJOIN_TOOLTIP="设置矢量元素的连线样式。",o.FIELD_ATTR_BOUNDING_TOOLTIP="使用%1的边界方式来检测碰撞。",o.FIELD_ATTR_STROKECOLOR_TOOLTIP="设置一个矢量元素或文本元素的描线颜色。",o.FIELD_ATTR_FILLCOLOR_TOOLTIP="设置一个矢量元素或文本元素的填充颜色。",o.FIELD_ATTR_CURSOR_TOOLTIP="设置光标形状。",o.FIELD_ATTR_DRAGGABLE_TOOLTIP="可拖拽？",o.RANDOM_STRING_MSG0="🎲 随机字符串",o.RANDOM_STRING_TOOLTIP="获得一个11个字符长度的随机字符串。",o.RANDOM_COLOUR_RGB_MSG0="🎲 随机颜色",o.RANDOM_COLOUR_RGB_TOOLTIP="获得一个随机的RGB颜色。",o.RANDOM_COLOUR_HUE_MSG0="🎲 随机色调",o.RANDOM_COLOUR_HUE_MSG1="饱和 %1% 亮 %2% 透明 %3.",o.RANDOM_COLOUR_HUE_TOOLTIP="获得一个随机的HSLA颜色。",o.LOG_OPTION_LOG_LOG="记录",o.LOG_OPTION_LOG_WARN="警告",o.LOG_OPTION_LOG_ERROR="错误",o.LOG_TOOLTIP="输出信息到控制台。",o.LOG_ALERT_MSG0="🔔 弹出 %1",o.LOG_ALERT_TOOLTIP="弹出一个会话框。",o.SIGNAL_DO_MSG0="当收到信号为 %1 🚩 执行",o.SIGNAL_DO_TOOLTIP="当收到指定信号时，执行动作。",o.SIGNAL_DO_OPTION_SIGNAL_START="开始运行",o.SIGNAL_DO_OPTION_SIGNAL_STORE_PROPERTY_UPDATE="共享数据内容更新",o.SIGNAL_DO_OPTION_SIGNAL_LAYER_CLICKED="前景图层被鼠标点击",o.SIGNAL_DO_OPTION_SIGNAL_KEYDOWN="键盘按键按下",o.SIGNAL_DO_OPTION_SIGNAL_KEYUP="键盘按键松开",o.SIGNAL_DO_OPTION_SIGNAL_ELEMENT_CREATED="元素被创建",o.SIGNAL_DO_OPTION_SIGNAL_ELEMENT_DESTROYED="元素被销毁",o.SIGNAL_NEW_SPRITE_AS_RECEIVER_MSG0="收到信号为 %1 🚩 时",o.SIGNAL_NEW_SPRITE_AS_RECEIVER_MSG1="创建 %1 作为接收者",o.SIGNAL_NEW_SPRITE_AS_RECEIVER_MSG2="ID设为 %1",o.SIGNAL_NEW_SPRITE_AS_RECEIVER_TOOLTIP="收到某个信号时，新建一个元素作为接收者并执行动作。",o.SIGNAL_WHEN_RECEIVER_IS_MSG0="收到信号 %1 🚩",o.SIGNAL_WHEN_RECEIVER_IS_MSG1="当接收者为 %1 时",o.SIGNAL_NEW_SPRITE_AS_RECEIVER_TOOLTIP="收到某个信号且接收者为特定元素时，执行动作。",o.GET_DATA_MSG0="消息",o.GET_DATA_TOOLTIP="读取信号消息。",o.GET_DATA_PROP_MSG0="消息的 %1",o.GET_DATA_PROP_TOOLTIP="读取信号的数据属性。如果信号是由事件触发，可读取这些属性。",o.GET_DATA_PROP_TOOLTIP2="读取信号的数据属性。如果信号是存储数据改变，可读取这些属性。",o.GET_DATA_PROP_OPTION_PROP_OFFSETX="相对坐标X",o.GET_DATA_PROP_OPTION_PROP_OFFSETY="相对坐标Y",o.GET_DATA_PROP_OPTION_PROP_LAYERX="绝对坐标X",o.GET_DATA_PROP_OPTION_PROP_LAYERY="绝对坐标Y",o.GET_DATA_PROP_OPTION_PROP_ALTKEY="按下ALT键",o.GET_DATA_PROP_OPTION_PROP_CTRLKEY="按下CTRL键",o.GET_DATA_PROP_OPTION_PROP_SHIFTKEY="按下SHIFT键",o.GET_DATA_PROP_OPTION_PROP_BUTTONS="鼠标按键值",o.GET_DATA_PROP_OPTION_PROP_KEY="键盘按键值",o.GET_DATA_PROP_OPTION_PROP_KEYCODE="键盘按键值编码",o.GET_DATA_PROP_OPTION_PROP_PROPERTY="更新的存储属性",o.GET_DATA_PROP_OPTION_PROP_OLDVALUE="属性原值",o.GET_DATA_PROP_OPTION_PROP_NEWVALUE="属性新值",o.EVENT_IMMEDIATELY="立即",o.EVENT_ONCLICK="被单击",o.EVENT_ONDBLCLICK="被双击",o.EVENT_ONMOUSEDOWN="按下鼠标按键",o.EVENT_ONMOUSEMOVE="鼠标在它内部移动",o.EVENT_ONMOUSEUP="释放鼠标按键",o.EVENT_ONMOUSEENTER="鼠标进入它",o.EVENT_ONMOUSELEAVE="鼠标离开它",o.EVENT_ONTAP="触屏短按",o.EVENT_ONLONGTAP="触屏长按",o.EVENT_ONDRAGGED="被拖拽",o.EVENT_ONDRAGGEDONTO="其它元素拖拽入",o.EVENT_ONCOLLISION="与其他元素碰撞",o.SIGNAL_ONEVENT_SEND_MSG0="%1 %2 发送 %3 🚩",o.SIGNAL_ONEVENT_SEND_MSG1="包含消息 %1",o.SIGNAL_ONEVENT_SEND_TOOLTIP="当事件发生时，发送信号。",o.SPRITE_MSG0_TOOLTIP="指定元素。\n"+o.SENDER_RECEIVER_TARGET_TOOLTIP,o.SPRITE_APPEND_TO_MSG0="将 %1 添加到 %2",o.SPRITE_APPEND_TO_TOOLTIP="添加元素到层。",o.SPRITE_ATTRS_MSG0="设置 %1 属性",o.SPRITE_ATTRS_TOOLTIP="设置属性值到元素。",o.SPRITE_CREATE_ATTRS_MSG0="创建 %1",o.SPRITE_CREATE_ATTRS_MSG1="命名为 %1 包含属性",o.SPRITE_CREATE_ATTRS_TOOLTIP="创建一个指定名字的元素。可以使用循环语句创建多个同名元素。",o.SPRITE_EACH_ELEMENTS_NAMED_MSG0="所有名为 %1 的元素",o.SPRITE_EACH_ELEMENTS_NAMED_TOOLTIP="获得指定名字的全部元素。",o.SPRITE_DESTROY_MSG0="💣 销毁 %1",o.SPRITE_DESTROY_TOOLTIP="将元素移除层并销毁。",o.SPRITE_GET_ATTR_MSG0="%1 的 %2",o.SPRITE_GET_ATTR_TOOLTIP="读取目标元素的属性值。",o.MATH_RANDOM_INT_TITLE="🎲 "+o.MATH_RANDOM_INT_TITLE,o.MATH_RANDOM_FLOAT_TITLE_RANDOM="🎲 "+o.MATH_RANDOM_FLOAT_TITLE_RANDOM,o.LIST_FOREACH_MSG0="遍历列表 %1:",o.LIST_FOREACH_MSG1="执行 %1",o.LIST_FOREACH_MSG2="%1 代表每个元素, %2 代表索引",o.LIST_FOREACH_TOOLTIP="遍历列表每个元素，执行动作。",o.LIST_INDEX_TOOLTIP="获取迭代索引。",o.LIST_ITEM_TOOLTIP="获取迭代元素。",o.OBJECT_GET_PROP_MSG0="%1.%2",o.OBJECT_GET_PROP_TOOLTIP="读取对象属性。",o.LISTS_CREATE_RANGE_MSG0="创建列表范围",o.LISTS_CREATE_RANGE_MSG1="从 %1 到 %2",o.LISTS_CREATE_RANGE_TOOLTIP="通过整数范围创建列表。",o.STORE_SET_MSG0="📝 设置 %1 的值为 %2",o.STORE_SET_TOOLTIP="设置共享数据的值。",o.STORE_GET_MSG0="📝 获取 %1 的值",o.STORE_GET_TOOLTIP="获取共享数据的值。",o.STORE_DELETE_MSG0="✂️ 删除 %1 的值",o.STORE_DELETE_TOOLTIP="删除共享数据的值。",o.FIELD_ATTR_TEXTUREFRAME_MSG0="动画帧 %1",o.FIELD_ATTR_TEXTUREFRAME_MSG1="持续时间 %1秒",o.FIELD_ATTR_TEXTUREFRAME_TOOLTIP="在元素上设置动画帧，动画帧会自动循环播放。",o.SOUND_PLAY_MSG0="🔔 %1",o.SOUND_PLAY_TOOLTIP="播放声音。",o.PROCEDURES_DEFRETURN_TITLE="定义：",o.PROCEDURES_DEFNORETURN_DO="执行",o.PROCEDURES_MUTATORARG_TITLE="参数名称",o.PROCEDURES_BEFORE_PARAMS="参数：",o.PROCEDURES_CALL_BEFORE_PARAMS="令：",o.PROCEDURES_AWAIT_MSG0="⌛️ 得到异步执行结果 %1",o.PROCEDURES_AWAIT_TOOLTIP="等待直到得到异步执行结果。",o.SPRITE_DELETED="该元素已被删除。"},function(t,e,n){const i=n(0),o=i.Msg;function r(t="key",e="",n=i.Msg.ATTRS_HUE,r="KeyValue"){const _={name:"KEY",type:"field_dropdown"},a={type:"input_value",name:"VALUE",check:e};return"string"==typeof t&&(t=[t]),Array.isArray(t)?_.options=t.map(t=>[o.$(t,"ATTR"),t]):"string"!=typeof t&&t.prop&&t.options&&(_.options=[[o.$(t.prop,"ATTR"),t.prop]],a.type="field_dropdown",a.options=t.options.map(t=>[o.$(t,"ATTR_VALUE"),t])),{message0:o.KEYVALUE_MSG0,args0:[_,a],colour:n,previousStatement:r,nextStatement:r}}function _(t){return`\n'${t.getFieldValue("KEY")}': ${i.JavaScript.valueToCode(t,"VALUE",i.JavaScript.ORDER_NONE)||`'${t.getFieldValue("VALUE")}'`||"null"},`}i.Blocks.field_attr_inc={init(){this.jsonInit({message0:o.FIELD_ATTR_INC_MSG0,args0:[{type:"field_dropdown",name:"OP",options:[["+","+"],["-","-"],["*","*"],["/","/"],["^","**"]]},{type:"input_value",name:"VALUE",check:"Number"}],colour:i.Msg.ATTRS_HUE,tooltip:o.FIELD_ATTR_INC_TOOLTIP}),this.setOutput(!0,"Number")}},i.JavaScript.field_attr_inc=function(t){return[`v => v ${t.getFieldValue("OP")} ${i.JavaScript.valueToCode(t,"VALUE",i.JavaScript.ORDER_NONE)||0}`,i.JavaScript.ORDER_NONE]},i.Blocks.field_attr_anchor={init(){this.jsonInit(r(["anchorX","anchorY"],"Number")),this.setTooltip(()=>o.FIELD_ATTR_ANCHOR_TOOLTIP.replace("%1",o.$(this.getFieldValue("KEY"),"ATTR")))}},i.Blocks.field_attr_xy={init(){this.jsonInit(r(["x","y"],"Number")),this.setTooltip(()=>o.FIELD_ATTR_XY_TOOLTIP.replace("%1",o.$(this.getFieldValue("KEY"),"ATTR")))}},i.Blocks.field_attr_size={init(){this.jsonInit(r(["width","height"],"Number")),this.setTooltip(()=>o.FIELD_ATTR_SIZE_TOOLTIP.replace("%1",o.$(this.getFieldValue("KEY"),"ATTR")))}},i.Blocks.field_attr_bgcolor={init(){this.jsonInit(r("bgcolor","Colour")),this.setTooltip(o.FIELD_ATTR_BGCOLOR_TOOLTIP)}},i.Blocks.field_attr_opacity={init(){this.jsonInit(r("opacity","Number")),this.setTooltip(o.FIELD_ATTR_OPACITY_TOOLTIP)}},i.Blocks.field_attr_rotate={init(){this.jsonInit(r("rotate","Number")),this.setTooltip(o.FIELD_ATTR_ROTATE_TOOLTIP)}},i.Blocks.field_attr_scale={init(){this.jsonInit(r(["scaleX","scaleY"],"Number")),this.setTooltip(()=>o.FIELD_ATTR_SCALE_TOOLTIP.replace("%1",o.$(this.getFieldValue("KEY"),"ATTR")))}},i.Blocks.field_attr_translate={init(){this.jsonInit(r(["translateX","translateY"],"Number")),this.setTooltip(()=>o.FIELD_ATTR_TRANSLATE_TOOLTIP.replace("%1",o.$(this.getFieldValue("KEY"),"ATTR")))}},i.Blocks.field_attr_skew={init(){this.jsonInit(r(["skewX","skewY"],"Number")),this.setTooltip(()=>o.FIELD_ATTR_SKEW_TOOLTIP.replace("%1",o.$(this.getFieldValue("KEY"),"ATTR")))}},i.Blocks.field_attr_borderRadius={init(){this.jsonInit(r("borderRadius","Number")),this.setTooltip(o.FIELD_ATTR_BORDERRADIUS_TOOLTIP)}},i.Blocks.field_attr_borderWidth={init(){this.jsonInit(r("borderWidth","Number")),this.setTooltip(o.FIELD_ATTR_BORDERWIDTH_TOOLTIP)}},i.Blocks.field_attr_borderStyle={init(){this.jsonInit(r({prop:"borderStyle",options:["solid","dashed"]},"String")),this.setTooltip(o.FIELD_ATTR_BORDERSTYLE_TOOLTIP)}},i.Blocks.field_attr_borderColour={init(){this.jsonInit(r("borderColor","Colour")),this.setTooltip(o.FIELD_ATTR_BORDERCOLOR_TOOLTIP)}},i.Blocks.field_attr_dashOffset={init(){this.jsonInit(r("dashOffset","Number")),this.setTooltip(o.FIELD_ATTR_DASHOFFSET_TOOLTIP)}},i.Blocks.field_attr_texture={init(){this.jsonInit(r("texture","String",i.Msg.ATTRS_SPRITE_HUE)),this.setTooltip(o.FIELD_ATTR_TEXTURE_TOOLTIP)}},i.Blocks.field_attr_text={init(){this.jsonInit(r("text","String",i.Msg.ATTRS_LABEL_HUE)),this.setTooltip(o.FIELD_ATTR_TEXT_TOOLTIP)}},i.Blocks.field_attr_fontSize={init(){this.jsonInit(r("fontSize","Number",i.Msg.ATTRS_LABEL_HUE)),this.setTooltip(o.FIELD_ATTR_FONTSIZE_TOOLTIP)}},i.Blocks.field_attr_fontFamily={init(){this.jsonInit(r("fontFamily","String",i.Msg.ATTRS_LABEL_HUE)),this.setTooltip(o.FIELD_ATTR_FONTFAMILY_TOOLTIP)}},i.Blocks.field_attr_fontStyle={init(){this.jsonInit(r({prop:"fontStyle",options:["normal","italic","oblique"]},"String",i.Msg.ATTRS_LABEL_HUE)),this.setTooltip(o.FIELD_ATTR_FONTSTYLE_TOOLTIP)}},i.Blocks.field_attr_fontVariant={init(){this.jsonInit(r({prop:"fontVariant",options:["normal","small-caps"]},"String",i.Msg.ATTRS_LABEL_HUE)),this.setTooltip(o.FIELD_ATTR_FONTVARIANT_TOOLTIP)}},i.Blocks.field_attr_fontWeight={init(){this.jsonInit(r({prop:"fontWeight",options:["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"]},"String",i.Msg.ATTRS_LABEL_HUE)),this.setTooltip(o.FIELD_ATTR_FONTWEIGHT_TOOLTIP)}},i.Blocks.field_attr_textAlign={init(){this.jsonInit(r({prop:"textAlign",options:["left","right","center"]},"String",i.Msg.ATTRS_LABEL_HUE)),this.setTooltip(o.FIELD_ATTR_TEXTALIGN_TOOLTIP)}},i.Blocks.field_attr_lineHeight={init(){this.jsonInit(r("lineHeight","Number",i.Msg.ATTRS_LABEL_HUE)),this.setTooltip(o.FIELD_ATTR_LINEHEIGHT_TOOLTIP)}},i.Blocks.field_attr_d={init(){this.jsonInit(r("d","String",i.Msg.ATTRS_PATH_HUE)),this.setTooltip(o.FIELD_ATTR_D_TOOLTIP)}},i.Blocks.field_attr_lineWidth={init(){this.jsonInit(r("lineWidth","Number",i.Msg.ATTRS_PATH_HUE)),this.setTooltip(o.FIELD_ATTR_LINEWIDTH_TOOLTIP)}},i.Blocks.field_attr_lineDash={init(){this.jsonInit(r("lineDash","String",i.Msg.ATTRS_PATH_HUE)),this.setTooltip(o.FIELD_ATTR_LINEDASH_TOOLTIP)}},i.Blocks.field_attr_lineDashOffset={init(){this.jsonInit(r("lineDashOffset","Number",i.Msg.ATTRS_PATH_HUE)),this.setTooltip(o.FIELD_ATTR_LINEDASHOFFSET_TOOLTIP)}},i.Blocks.field_attr_lineCap={init(){this.jsonInit(r({prop:"lineCap",options:["butt","round","square"]},"String",i.Msg.ATTRS_PATH_HUE)),this.setTooltip(o.FIELD_ATTR_LINECAP_TOOLTIP)}},i.Blocks.field_attr_lineJoin={init(){this.jsonInit(r({prop:"lineJoin",options:["miter","round","bevel"]},"String",i.Msg.ATTRS_PATH_HUE)),this.setTooltip(o.FIELD_ATTR_LINEJOIN_TOOLTIP)}},i.Blocks.field_attr_bounding={init(){this.jsonInit(r({prop:"bounding",options:["box","path"]},"String",i.Msg.ATTRS_PATH_HUE)),this.setTooltip(()=>o.FIELD_ATTR_BOUNDING_TOOLTIP.replace("%1",o.$(this.getFieldValue("VALUE"),"ATTR_VALUE")))}},i.Blocks.field_attr_strokeColour={init(){this.jsonInit(r("strokeColor","Colour",i.Msg.ATTRS_PATH_HUE)),this.setTooltip(o.FIELD_ATTR_STROKECOLOR_TOOLTIP)}},i.Blocks.field_attr_fillColour={init(){this.jsonInit(r("fillColor","Colour",i.Msg.ATTRS_PATH_HUE)),this.setTooltip(o.FIELD_ATTR_FILLCOLOR_TOOLTIP)}},i.Blocks.field_attr_cursor={init(){this.jsonInit(r({prop:"cursor",options:["default","crosshair","pointer","move","e-resize","ne-resize","nw-resize","n-resize","se-resize","sw-resize","s-resize","w-resize","text","wait","help"]},"String",i.Msg.ATTRS_HUE)),this.setTooltip(o.FIELD_ATTR_CURSOR_TOOLTIP)}},i.Blocks.field_attr_draggable={init(){this.jsonInit(r({prop:"draggable",options:["yes","no"]},"String",i.Msg.ATTRS_HUE)),this.setTooltip(o.FIELD_ATTR_DRAGGABLE_TOOLTIP)}},i.Blocks.field_attr_textureFrame={init(){this.jsonInit({message0:o.FIELD_ATTR_TEXTUREFRAME_MSG0,args0:[{type:"input_value",name:"FRAME",check:"String"}],message1:o.FIELD_ATTR_TEXTUREFRAME_MSG1,args1:[{type:"input_value",name:"DURATION",check:"Number"}],nextStatement:"KeyValue",previousStatement:"KeyValue",colour:i.Msg.ATTRS_SPRITE_HUE,tooltip:o.FIELD_ATTR_TEXTUREFRAME_TOOLTIP})}},i.JavaScript.field_attr_textureFrame=function(t){return`\n'${"textureFrame$"+Math.random().toString(36).slice(2)}': ${`[${i.JavaScript.valueToCode(t,"FRAME",i.JavaScript.ORDER_NONE)||"null"}, ${i.JavaScript.valueToCode(t,"DURATION",i.JavaScript.ORDER_NONE)||"100"}]`},`},Object.keys(i.Blocks).forEach(t=>{0!==t.indexOf("field_attr")||i.JavaScript[t]||(i.JavaScript[t]=_)})},function(t,e,n){const i=n(0),o=i.Msg,r=o.ANIMATE_HUE;function _(t){let e=t.getParent();for(;null!=e;){if("procedures_defreturn"===e.type){e.isAsync_=!0;break}e=e.getParent()}}i.Blocks.await={init(){this.jsonInit({message0:o.AWAIT_MSG0,args0:[{type:"field_number",name:"MILLISEC",value:16}],colour:r,previousStatement:"Statement",nextStatement:null,tooltip:()=>o.AWAIT_TOOLTIP.replace("%1",this.getFieldValue("MILLISEC"))})}},i.JavaScript.await=function(t){const e=parseInt(t.getFieldValue("MILLISEC"),10);return _(t),`await spritly.runtime.wait(${e});\n`},i.Blocks.await_frame={init(){this.jsonInit({message0:o.AWAIT_FRAME_MSG0,args0:[{type:"field_dropdown",name:"LAYER",options:[[o.COMMON_FGLAYER,"fglayer"],[o.COMMON_BGLAYER,"bglayer"]]}],colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:o.AWAIT_FRAME_TOOLTIP})}},i.JavaScript.await_frame=function(t){const e=t.getFieldValue("LAYER");return _(t),`await spritly.runtime.scene.layer('${e}').prepareRender();\n`},i.Blocks.sprite_animate={init(){this.jsonInit({message0:o.SPRITE_ANIMATE_MSG0,args0:[{type:"field_dropdown",name:"ASYNC?",options:[[o.SPRITE_ANIMATE_OPTION_ASYNC_DEFAULT,"-"],[o.SPRITE_ANIMATE_OPTION_ASYNC_AWAIT,"await"]]},{type:"input_value",name:"SPRITE",check:"Sprite"},{type:"input_value",name:"DURATION",check:"Number"}],message1:o.SPRITE_ANIMATE_MSG1,args1:[{type:"input_statement",name:"FROM_ATTRS",check:"KeyValue"}],message2:o.SPRITE_ANIMATE_MSG2,args2:[{type:"input_statement",name:"TO_ATTRS",check:"KeyValue"}],message3:o.SPRITE_ANIMATE_MSG3,args3:[{type:"input_value",name:"EASING",check:"String"}],colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:o.SPRITE_ANIMATE_TOOLTIP})}},i.JavaScript.sprite_animate=function(t){const e="await"===t.getFieldValue("ASYNC?"),n=i.JavaScript.valueToCode(t,"SPRITE",i.JavaScript.ORDER_NONE)||"null",o=i.JavaScript.valueToCode(t,"DURATION",i.JavaScript.ORDER_NONE)||600,r=i.JavaScript.valueToCode(t,"EASING",i.JavaScript.ORDER_NONE)||'"ease"';let a=`${n}.animate([{${i.JavaScript.statementToCode(t,"FROM_ATTRS")}\n},{${i.JavaScript.statementToCode(t,"TO_ATTRS")}\n}], {duration: ${1e3*o}, fill: 'forwards', easing: ${r}})`;return e&&(_(t),a=`if(!${n}.layer) console.error('${n} must append to layer before animated!'); \nawait ${a}.finished`),a+";\n"},i.Blocks.easing={init(){this.jsonInit({message0:"%1",args0:[{type:"field_dropdown",name:"EASING",options:[[o.EASING_OPTION_EASING_EASE,"ease"],[o.EASING_OPTION_EASING_EASEIN,"ease-in"],[o.EASING_OPTION_EASING_EASEOUT,"ease-out"],[o.EASING_OPTION_EASING_EASEINOUT,"ease-in-out"]]}],colour:r,output:"String",tooltip:o.EASING_OPTION_TOOLTIP})}},i.JavaScript.easing=function(t){return[`'${t.getFieldValue("EASING")}'`,i.JavaScript.ORDER_NONE]},i.Blocks.bezier_easing={init(){this.jsonInit({message0:o.BEZIER_EASING_MSG0,args0:[{type:"field_number",name:"X0",value:.68},{type:"field_number",name:"Y0",value:-.55},{type:"field_number",name:"X1",value:.265},{type:"field_number",name:"Y1",value:1.55}],colour:r,output:"String",tooltip:o.BEZIER_EASING_TOOLTIP})}},i.JavaScript.bezier_easing=function(t){return[`'cubic-bezier(${t.getFieldValue("X0")},${t.getFieldValue("Y0")},${t.getFieldValue("X1")},${t.getFieldValue("Y1")})'`,i.JavaScript.ORDER_NONE]}},function(t,e,n){const i=n(0),o=i.Msg,r=i.Blocks.controls_if.init;i.Blocks.controls_if.init=function(){r.call(this);for(let t=0;t<20;t++){const e=this.getInput("DO"+t);if(!e)break;e.setCheck("Statement")}this.setNextStatement(!0,"Statement"),this.setPreviousStatement(!0,"Statement"),this.setColour(o.FLOWS_HUE)},i.Constants.Logic.CONTROLS_IF_MUTATOR_MIXIN.saveConnections=function(t){let e,n,i=t.nextConnection.targetBlock(),o=1;for(;i;){switch(i.type){case"controls_if_elseif":e=this.getInput("IF"+o),n=this.getInput("DO"+o),n.setCheck("Statement"),i.valueConnection_=e&&e.connection.targetConnection,i.statementConnection_=n&&n.connection.targetConnection,o++;break;case"controls_if_else":n=this.getInput("ELSE"),n.setCheck("Statement"),i.statementConnection_=n&&n.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+i.type)}i=i.nextConnection&&i.nextConnection.targetBlock()}};const _=i.Blocks.controls_repeat_ext.init;i.Blocks.controls_repeat_ext.init=function(){_.call(this),this.getInput("DO").setCheck("Statement"),this.setNextStatement(!0,"Statement"),this.setPreviousStatement(!0,"Statement"),this.setColour(o.FLOWS_HUE)},i.JavaScript.controls_repeat_ext=function(t){let e;e=t.getField("TIMES")?String(Number(t.getFieldValue("TIMES"))):i.JavaScript.valueToCode(t,"TIMES",i.JavaScript.ORDER_ASSIGNMENT)||"0";let n=i.JavaScript.statementToCode(t,"DO");n=i.JavaScript.addLoopTrap(n,t.id);let o="";const r=i.JavaScript.variableDB_.getDistinctName("count",i.Variables.NAME_TYPE);let _=e,a="";return e.match(/^\w+$/)||i.isNumber(e)||(_=i.JavaScript.variableDB_.getDistinctName("repeat_end",i.Variables.NAME_TYPE),a=`, ${_} = ${e}`),o+=`for(let ${r} = 0${a}; ${r} < ${_}; ${r}++){\n${n}}\n`,o};const a=i.Blocks.controls_whileUntil.init;i.Blocks.controls_whileUntil.init=function(){a.call(this),this.getInput("DO").setCheck("Statement"),this.setNextStatement(!0,"Statement"),this.setPreviousStatement(!0,"Statement"),this.setColour(o.FLOWS_HUE)},i.Blocks.list_foreach={init(){this.jsonInit({message0:o.LIST_FOREACH_MSG0,args0:[{type:"input_value",name:"LIST",check:["String","Array"]}],message1:o.LIST_FOREACH_MSG1,args1:[{type:"input_statement",name:"DO",check:"Statement"}],message2:o.LIST_FOREACH_MSG2,args2:[{type:"field_input",name:"ITEM",text:"item"},{type:"field_dropdown",name:"INDEX",options:["i","j","k","l","m"].map(t=>[t,t])}],colour:o.FLOWS_HUE,previousStatement:"Statement",nextStatement:"Statement",tooltip:o.LIST_FOREACH_TOOLTIP})}},i.JavaScript.list_foreach=function(t){const e=i.JavaScript.valueToCode(t,"LIST",i.JavaScript.ORDER_NONE)||"[]",n=t.getFieldValue("ITEM"),o=t.getFieldValue("INDEX");let r=i.JavaScript.statementToCode(t,"DO"),_=/^([\s\t]+)/.exec(r);return _=_?"\n"+_[0]:"\n"+i.Generator.prototype.INDENT,r&&(r+="\n"),`await ${e}.reduce(async function($$prestep, ${n}, ${o}) {${_}await $$prestep;\n${r}}, null);\n`},i.Blocks.list_index={init(){this.jsonInit({message0:"%1",args0:[{type:"field_dropdown",name:"INDEX",options:["i","j","k","l","m"].map(t=>[t,t])}],output:"Number",colour:o.FLOWS_HUE,tooltip:o.LIST_INDEX_TOOLTIP})}},i.JavaScript.list_index=function(t){return[t.getFieldValue("INDEX"),i.JavaScript.ORDER_NONE]},i.Blocks.list_item={init(){this.jsonInit({message0:"%1",args0:[{type:"field_dropdown",name:"ITEM",options:()=>{const t=this.workspace.getBlocksByType("list_foreach");return t.length?t.map(t=>{const e=t.getFieldValue("ITEM");return[e,e]}):[["item","item"]]}}],output:null,colour:o.FLOWS_HUE,tooltip:o.LIST_ITEM_TOOLTIP})}},i.JavaScript.list_item=function(t){return[t.getFieldValue("ITEM"),i.JavaScript.ORDER_NONE]}},function(t,e,n){const i=n(0),o=i.Msg;i.Blocks.nil={init(){this.jsonInit({message0:"%1",args0:[{type:"field_dropdown",name:"VALUE",options:[[o.LITERAL_NULL,"null"],[o.LITERAL_UNDEFINED,"undefined"]]}],colour:o.LITERAL_HUE}),this.setOutput(!0),this.setTooltip(()=>o.NIL_TOOLTIP.replace("%1",this.getFieldValue("VALUE")))}},i.JavaScript.nil=function(t){return[t.getFieldValue("VALUE"),i.JavaScript.ORDER_NONE]},i.Blocks.boolean={init(){i.Blocks.logic_boolean.init.call(this),this.setColour(i.Msg.LITERAL_HUE)}},i.JavaScript.boolean=i.JavaScript.logic_boolean,i.Blocks.number={init(){i.Blocks.math_number.init.call(this),this.setColour(i.Msg.LITERAL_HUE)}},i.JavaScript.number=i.JavaScript.math_number,i.Blocks.string={init(){this.jsonInit({message0:"%1 %2",args0:[{type:"field_input",name:"TEXT",text:""},{type:"input_value",name:"NEXT"}],output:"String",colour:i.Msg.LITERAL_HUE,helpUrl:i.Msg.TEXT_TEXT_HELPURL,tooltip:i.Msg.TEXT_TEXT_TOOLTIP,extensions:["text_quotes","parent_tooltip_when_inline"]})}},i.JavaScript.string=function(t){const e=i.JavaScript.text(t),n=i.JavaScript.valueToCode(t,"NEXT",i.JavaScript.ORDER_ATOMIC);return n?[`${e[0]} + ${n}`,e[1]]:e},i.Blocks.object_create={init(){this.appendDummyInput().appendField("new Object"),this.appendStatementInput("FIELDS").setCheck(["KeyValue"]),this.setOutput(!0),this.setColour(o.LITERAL_HUE),this.setTooltip(o.OBJECT_CREATE_TOOLTIP)}},i.JavaScript.object_create=function(t){return[`{${i.JavaScript.statementToCode(t,"FIELDS")}\n}`,i.JavaScript.ORDER_MEMBER]};const r=i.Blocks.colour_picker.init;i.Blocks.colour_picker.init=function(){r.call(this),this.setColour(i.Msg.LITERAL_HUE)},i.Blocks.loop_get_index={init(){this.jsonInit({message0:o.LOOP_GET_INDEX_MSG0,colour:o.LITERAL_HUE,output:"Number",tooltip:o.LOOP_GET_INDEX_TOOLTIP})}},i.JavaScript.loop_get_index=function(t){return["index",i.JavaScript.ORDER_NONE]}},function(t,e,n){const i=n(0),o=i.Msg,r=i.Msg.SIGNALS_HUE;function _(t,...e){const n=["START","STORE_PROPERTY_UPDATE","LAYER_CLICKED","KEYDOWN","KEYUP","ELEMENT_CREATED","ELEMENT_DESTROYED"];return()=>{const i=t.getBlocksByType("signal_onevent_send").map(t=>t.getFieldValue("SIGNAL"));return[...n,...e,...i].map(t=>[o.$(t,"SIGNAL_DO_OPTION_SIGNAL"),t])}}i.Blocks.signal_do={init(){this.jsonInit({message0:o.SIGNAL_DO_MSG0,args0:[{type:"field_dropdown",name:"SIGNAL",options:_(this.workspace)}],colour:r,nextStatement:"Statement",tooltip:o.SIGNAL_DO_TOOLTIP})},scope(t,e){return`spritly.runtime.Signal.on('${this.getFieldValue("SIGNAL")}', async function(sender, data){\n  let target = data[spritly.runtime.Symbols.target] || sender;\n  let receiver = target;\n\n${t.indent(e)}});`}},i.JavaScript.signal_do=function(t){return""},i.Blocks.signal_new_sprite_as_receiver={init(){const t="Sprite_"+Math.random().toString().slice(2,7);this.jsonInit({message0:o.SIGNAL_NEW_SPRITE_AS_RECEIVER_MSG0,args0:[{type:"field_dropdown",name:"SIGNAL",options:_(this.workspace)}],message1:o.SIGNAL_NEW_SPRITE_AS_RECEIVER_MSG1,args1:[{type:"field_dropdown",name:"TYPE",options:[[o.COMMON_SPRITE,"Sprite"],[o.COMMON_LABEL,"Label"],[o.COMMON_PATH,"Path"]]}],message2:o.SIGNAL_NEW_SPRITE_AS_RECEIVER_MSG2,args2:[{type:"field_input",name:"ID",text:t}],colour:r,nextStatement:"Statement",tooltip:o.SIGNAL_NEW_SPRITE_AS_RECEIVER_TOOLTIP})},updated(t){if("field"===t.element&&"ID"===t.name){this.workspace.getBlocksByType("sprite").forEach(e=>{e.getFieldValue("SPRITE")===t.oldValue&&e.setFieldValue(t.newValue,"SPRITE")})}},destroyed(){const t=this.getFieldValue("ID");this.workspace.getBlocksByType("sprite").forEach(e=>{e.getFieldValue("SPRITE")===t&&(e.setDisabled(!0),e.setWarningText(i.Msg.SPRITE_DELETED))})},scope(t,e){const n=this.getFieldValue("SIGNAL"),i=this.getFieldValue("ID");return`spritly.runtime.Signal.on('${n}', async function(sender, data){\n  let receiver = spritly.runtime.ElementList.getElementById('${i}');\n  if(receiver == null){\n    receiver = spritly.runtime.spritejs.createElement('${this.getFieldValue("TYPE")}', {id: '${i}'});\n    spritly.runtime.ElementList.add(receiver);\n  }\n  let target = data[spritly.runtime.Symbols.target] || receiver;\n\n${t.indent(e)}});`}},i.JavaScript.signal_new_sprite_as_receiver=function(t){return""},i.Blocks.signal_when_receiver_is={init(){this.jsonInit({message0:o.SIGNAL_WHEN_RECEIVER_IS_MSG0,args0:[{type:"field_dropdown",name:"SIGNAL",options:_(this.workspace,"ELEMENT_CREATED")}],message1:o.SIGNAL_WHEN_RECEIVER_IS_MSG1,args1:[{type:"field_dropdown",name:"ID",options:()=>function(t){const e=t.getBlocksByType("signal_new_sprite_as_receiver").map(t=>t.getFieldValue("ID"));return e.length>0?e.map(t=>[t,t]):[["",""]]}(this.workspace)}],colour:r,nextStatement:"Statement",tooltip:o.SIGNAL_NEW_SPRITE_AS_RECEIVER_TOOLTIP})},scope(t,e){return`spritly.runtime.Signal.on('${this.getFieldValue("SIGNAL")}', async function(sender, data){\n  const receiver = spritly.runtime.ElementList.getElementById('${this.getFieldValue("ID")}');\n  let target = data[spritly.runtime.Symbols.target] || receiver;\n\n${t.indent(e)};});`}},i.JavaScript.signal_when_receiver_is=function(){return""},i.Blocks.get_data={init(){this.jsonInit({message0:o.GET_DATA_MSG0,colour:r,output:"Object",tooltip:o.GET_DATA_TOOLTIP})}},i.JavaScript.get_data=function(t){return["data",i.JavaScript.ORDER_NONE]},i.Blocks.get_data_prop={init(){this.jsonInit({message0:o.GET_DATA_PROP_MSG0,args0:[{type:"field_dropdown",name:"PROP",options:["offsetX","offsetY","layerX","layerY","altKey","ctrlKey","shiftKey","buttons","key","keyCode"].map(t=>[o.$(t,"GET_DATA_PROP_OPTION_PROP"),t])}],colour:r,output:["Number","String","Boolean"],tooltip:o.GET_DATA_PROP_TOOLTIP})}},i.JavaScript.get_data_prop=function(t){return[`data[spritly.runtime.Symbols.${t.getFieldValue("PROP")}]`,i.JavaScript.ORDER_NONE]},i.Blocks.get_store_data_prop={init(){this.jsonInit({message0:o.GET_DATA_PROP_MSG0,args0:[{type:"field_dropdown",name:"PROP",options:["property","oldValue","newValue"].map(t=>[o.$(t,"GET_DATA_PROP_OPTION_PROP"),t])}],colour:r,output:null,tooltip:o.GET_DATA_PROP_TOOLTIP2})}},i.JavaScript.get_store_data_prop=function(t){return[`data[spritly.runtime.Symbols.${t.getFieldValue("PROP")}]`,i.JavaScript.ORDER_MEMBER]};const a=["immediately","onclick","ondblclick","onmousedown","onmousemove","onmouseup","onmouseenter","onmouseleave","ontap","onlongtap","ondragged","ondraggedonto","oncollision"];i.Blocks.signal_onevent_send={init(){this.jsonInit({message0:o.SIGNAL_ONEVENT_SEND_MSG0,args0:[{type:"input_value",name:"SPRITE",check:"Sprite"},{type:"field_dropdown",name:"EVENT",options:a.map(t=>[o.$(t,"EVENT"),t])},{type:"field_input",name:"SIGNAL",text:"MY_SIGNAL"}],message1:o.SIGNAL_ONEVENT_SEND_MSG1,args1:[{type:"input_statement",name:"DATA",check:"KeyValue"}],colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:`${o.SIGNAL_ONEVENT_SEND_TOOLTIP}\n${o.SENDER_RECEIVER_TARGET_TOOLTIP}`})}},i.JavaScript.signal_onevent_send=function(t){const e=i.JavaScript.valueToCode(t,"SPRITE",i.JavaScript.ORDER_NONE)||"null",n=t.getFieldValue("EVENT"),o=t.getFieldValue("SIGNAL"),r=i.JavaScript.statementToCode(t,"DATA");if("immediately"!==n&&"oncollision"!==n){return`${e}.on('${n.slice(2)}', \n  evt => {\n    const {altKey, buttons, ctrlKey, shiftKey} = evt.originalEvent;\n    const runtime = spritly.runtime;\n    runtime.Signal.send('${o}', ${e},\n      Object.assign(\n        {\n          [runtime.Symbols.target]: evt.target,\n          [runtime.Symbols.offsetX]: evt.offsetX,\n          [runtime.Symbols.offsetY]: evt.offsetY,\n          [runtime.Symbols.layerX]: evt.layerX,\n          [runtime.Symbols.layerY]: evt.layerY,\n          [runtime.Symbols.altKey]: altKey,\n          [runtime.Symbols.buttons]: buttons,\n          [runtime.Symbols.ctrlKey]: ctrlKey,\n          [runtime.Symbols.shiftKey]: shiftKey,\n        },\n        {${r}},\n      ));\n  });`}return"oncollision"===n?`${e}.on('update', () => {\n  spritly.runtime.getCollisions(${e}).forEach((s) => {\n    spritly.runtime.Signal.send('${o}', ${e}, {[spritly.runtime.Symbols.target]: s});      \n  });\n});\n${e}.forceUpdate();\n`:`spritly.runtime.Signal.send('${o}', ${e}, {${r}});\n`}},function(t,e,n){const i=n(0),o=i.Msg,r=i.Msg.SPRITE_HUE;function _(){return["id","name","anchorX","anchorY","x","y","width","height","bgcolor","opacity","rotate","scaleX","scaleY","translateX","translateY","skewX","skewY","borderRadius","borderWidth","borderStyle","borderColor","dashOffset","texture","text","fontSize","fontFamily","fontStyle","fontVariant","fontWeight","textAlign","lineHeight","d","lineWidth","lineDash","lineDashOffset","lineCap","lineJoin","bounding","strokeColor","fillColor"].map(t=>[o.$(t,"ATTR"),t])}i.Blocks.sprite={init(){this.jsonInit({message0:"%1",args0:[{type:"field_dropdown",name:"SPRITE",options:()=>{const t=this.workspace.getBlocksByType("signal_new_sprite_as_receiver").map(t=>t.getFieldValue("ID"));return[[o.COMMON_TARGET,"target"],[o.COMMON_SENDER,"sender"],[o.COMMON_RECEIVER,"receiver"],...t.map(t=>[t,t])]}}],colour:r,output:"Sprite",tooltip:o.SPRITE_MSG0_TOOLTIP})},updated(t){"field"===t.element&&"SPRITE"===t.name&&(this.setWarningText(null),this.setDisabled(!1))}},i.JavaScript.sprite=function(t){let e=t.getFieldValue("SPRITE");return"target"!==e&&"sender"!==e&&"receiver"!==e&&"item"!==e&&(e=`spritly.runtime.ElementList.getElementById('${e}')`),[e,i.JavaScript.ORDER_NONE]},i.Blocks.sprite_append_to={init(){this.jsonInit({message0:o.SPRITE_APPEND_TO_MSG0,args0:[{type:"input_value",name:"SPRITE",check:"Sprite"},{type:"field_dropdown",name:"LAYER",options:[[o.COMMON_FGLAYER,"fglayer"],[o.COMMON_BGLAYER,"bglayer"]]}],colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:`${o.SPRITE_APPEND_TO_TOOLTIP}\n${o.FGLAYER_BGLAYER_TOOTIP}`})}},i.JavaScript.sprite_append_to=function(t){const e=i.JavaScript.valueToCode(t,"SPRITE",i.JavaScript.ORDER_NONE)||"null";return`spritly.runtime.scene.layer('${t.getFieldValue("LAYER")}').append(${e});\n`},i.Blocks.sprite_attrs={init(){this.jsonInit({message0:o.SPRITE_ATTRS_MSG0,args0:[{type:"input_value",name:"SPRITE",check:"Sprite"}],message1:"%1",args1:[{type:"input_statement",name:"ATTRS",check:"KeyValue"}],colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:o.SPRITE_ATTRS_TOOLTIP})}},i.JavaScript.sprite_attrs=function(t){const e=i.JavaScript.valueToCode(t,"SPRITE",i.JavaScript.ORDER_NONE)||"null";return`${e}.attr(spritly.runtime.parse_attr(${e}, {${i.JavaScript.statementToCode(t,"ATTRS")}\n}));\n`},i.Blocks.sprite_create_attrs={init(){this.jsonInit({message0:o.SPRITE_CREATE_ATTRS_MSG0,args0:[{type:"field_dropdown",name:"TYPE",options:[[o.COMMON_SPRITE,"Sprite"],[o.COMMON_LABEL,"Label"],[o.COMMON_PATH,"Path"]]}],message1:o.SPRITE_CREATE_ATTRS_MSG1,args1:[{type:"field_input",name:"NAME",text:"MyName"}],message2:"%1",args2:[{type:"input_statement",name:"ATTRS",check:"KeyValue"}],colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:o.SPRITE_CREATE_ATTRS_TOOLTIP})}},i.JavaScript.sprite_create_attrs=function(t){return`spritly.runtime.ElementList.add((function () {\n  const sprite = spritly.runtime.spritejs.createElement('${t.getFieldValue("TYPE")}');\n  sprite.attr(spritly.runtime.parse_attr(sprite, {name: '${t.getFieldValue("NAME")}'}, {${i.JavaScript.statementToCode(t,"ATTRS").split(/\n/g).join("\n"+i.Generator.prototype.INDENT)}\n  }));\n  return sprite;\n}()));\n`},i.Blocks.sprite_each_elements_named={init(){this.jsonInit({message0:o.SPRITE_EACH_ELEMENTS_NAMED_MSG0,args0:[{type:"field_dropdown",name:"NAME",options:()=>{const t=this.workspace.getBlocksByType("sprite_create_attrs").map(t=>t.getFieldValue("NAME"));return t.length>0?t.map(t=>[t,t]):[["",""]]}}],colour:r,output:"Array",tooltip:o.SPRITE_EACH_ELEMENTS_NAMED_TOOLTIP})}},i.JavaScript.sprite_each_elements_named=function(t){return[`spritly.runtime.ElementList.getElementsByName('${t.getFieldValue("NAME")}')`,i.JavaScript.ORDER_NONE]},i.Blocks.sprite_destroy={init(){this.jsonInit({message0:o.SPRITE_DESTROY_MSG0,args0:[{type:"input_value",name:"SPRITE",check:"Sprite"}],colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:o.SPRITE_DESTROY_TOOLTIP})}},i.JavaScript.sprite_destroy=function(t){return`spritly.runtime.ElementList.remove(${i.JavaScript.valueToCode(t,"SPRITE",i.JavaScript.ORDER_NONE)||"null"});\n`},i.Blocks.sprite_get_attr={init(){this.jsonInit({message0:o.SPRITE_GET_ATTR_MSG0,args0:[{type:"input_value",name:"SPRITE",check:"Sprite"},{type:"field_dropdown",name:"ATTR",options:_}],colour:r,output:!0,tooltip:o.SPRITE_GET_ATTR_TOOLTIP})}},i.JavaScript.sprite_get_attr=function(t){return[`spritly.runtime.get_attr(${i.JavaScript.valueToCode(t,"SPRITE",i.JavaScript.ORDER_NONE)||"null"}, '${t.getFieldValue("ATTR")}')`,i.JavaScript.ORDER_NONE]}},function(t,e,n){const i=n(0),o=i.Msg,r=i.Msg.LOG_HUE;i.Blocks.log_log={init(){this.jsonInit({message0:"📋 %1 %2",args0:[{type:"field_dropdown",name:"LOG",options:[[o.LOG_OPTION_LOG_LOG,"log"],[o.LOG_OPTION_LOG_WARN,"warn"],[o.LOG_OPTION_LOG_ERROR,"error"]]},{type:"input_value",name:"MSG"}],colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:o.LOG_TOOLTIP})}},i.JavaScript.log_log=function(t){const e=i.JavaScript.valueToCode(t,"MSG",i.JavaScript.ORDER_NONE);return`console.${t.getFieldValue("LOG")}(${e});\n`},i.Blocks.log_alert={init(){this.jsonInit({message0:o.LOG_ALERT_MSG0,args0:[{type:"input_value",name:"MSG"}],colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:o.LOG_ALERT_TOOLTIP})}},i.JavaScript.log_alert=function(t){return`alert(${i.JavaScript.valueToCode(t,"MSG",i.JavaScript.ORDER_NONE)});\n`}},function(t,e,n){const i=n(0),o=i.Msg,r=i.Msg.MATH_HUE;i.Blocks.random_string={init(){this.jsonInit({message0:o.RANDOM_STRING_MSG0,colour:r,output:"String",tooltip:o.RANDOM_STRING_TOOLTIP})}},i.JavaScript.random_string=function(t){return["'Math.random().toString(36).slice(2)'",i.JavaScript.ORDER_NONE]},i.Blocks.random_colour_rgb={init(){this.jsonInit({message0:o.RANDOM_COLOUR_RGB_MSG0,colour:r,output:"Colour",tooltip:o.RANDOM_COLOUR_RGB_TOOLTIP})}},i.JavaScript.random_colour_rgb=function(t){return["spritly.runtime.random_color()",i.JavaScript.ORDER_NONE]},i.Blocks.random_colour_hue={init(){this.jsonInit({message0:o.RANDOM_COLOUR_HUE_MSG0,message1:o.RANDOM_COLOUR_HUE_MSG1,args1:[{type:"field_number",name:"S",value:100},{type:"field_number",name:"L",value:50},{type:"field_number",name:"A",value:1}],colour:r,output:"Colour",tooltip:o.RANDOM_COLOUR_HUE_TOOLTIP})}},i.JavaScript.random_colour_hue=function(t){Math.floor(360*Math.random());return[`spritly.runtime.random_color_hue(${t.getFieldValue("S")},${t.getFieldValue("L")},${t.getFieldValue("A")})`,i.JavaScript.ORDER_NONE]}},function(t,e,n){const i=n(0),o=i.Msg,r=o.LISTS_HUE;i.Blocks.lists_create_range={init(){this.jsonInit({message0:o.LISTS_CREATE_RANGE_MSG0,message1:o.LISTS_CREATE_RANGE_MSG1,args1:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Array",colour:r,tooltip:o.LISTS_CREATE_RANGE_TOOLTIP})}},i.JavaScript.lists_create_range=function(t){const e=i.JavaScript.valueToCode(t,"FROM",i.JavaScript.ORDER_ASSIGNMENT)||"0",n=i.JavaScript.valueToCode(t,"TO",i.JavaScript.ORDER_ASSIGNMENT)||"0";return[`(Array.from({length: Math.abs(${e} - ${n}) + 1}).map((_, i) => ${e} + (${e} - ${n} > 0 ? -1 : 1) * i))`,i.JavaScript.ORDER_NONE]}},function(t,e,n){const i=n(0),o=i.Msg;i.Blocks.key_value={init(){this.jsonInit({message0:o.KEYVALUE_MSG0,args0:[{type:"input_value",name:"KEY",check:"String"},{type:"input_value",name:"VALUE"}],colour:o.GETTER_SETTER_HUE,previousStatement:"KeyValue",nextStatement:"KeyValue"}),this.setTooltip(o.KEYVALUE_TOOLTIP)}},i.JavaScript.key_value=function(t){return`\n${i.JavaScript.valueToCode(t,"KEY",i.JavaScript.ORDER_NONE)||"key"}: ${i.JavaScript.valueToCode(t,"VALUE",i.JavaScript.ORDER_NONE)||"null"},`},i.Blocks.object_get_prop={init(){this.jsonInit({message0:o.OBJECT_GET_PROP_MSG0,args0:[{type:"input_value",name:"OBJECT"},{type:"input_value",name:"PROP",check:"String"}],inputsInline:!0,output:null,colour:o.GETTER_SETTER_HUE}),this.setTooltip(o.OBJECT_GET_PROP_TOOLTIP)}},i.JavaScript.object_get_prop=function(t){return[`${i.JavaScript.valueToCode(t,"OBJECT",i.JavaScript.ORDER_NONE)||"Object()"}[${i.JavaScript.valueToCode(t,"PROP",i.JavaScript.ORDER_NONE)||"key"}]`,i.JavaScript.ORDER_NONE]}},function(t,e,n){const i=n(0),o=i.Msg,r=o.STORE_HUE;i.Blocks.store_set={init(){this.jsonInit({message0:o.STORE_SET_MSG0,args0:[{type:"input_value",name:"KEY",check:"String"},{type:"input_value",name:"VALUE"}],inputsInline:!0,colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:o.STORE_SET_TOOLTIP})}},i.JavaScript.store_set=function(t){return`spritly.runtime.Store.set(${i.JavaScript.valueToCode(t,"KEY",i.JavaScript.ORDER_MEMBER)||"'key'"}, ${i.JavaScript.valueToCode(t,"VALUE",i.JavaScript.ORDER_ASSIGNMENT)||"null"}, target);\n`},i.Blocks.store_get={init(){this.jsonInit({message0:o.STORE_GET_MSG0,args0:[{type:"input_value",name:"KEY",check:"String"}],colour:r,output:null,tooltip:o.STORE_GET_TOOLTIP})}},i.JavaScript.store_get=function(t){return[`spritly.runtime.Store.get(${i.JavaScript.valueToCode(t,"KEY",i.JavaScript.ORDER_MEMBER)||"'key'"})`,i.JavaScript.ORDER_NONE]},i.Blocks.store_delete={init(){this.jsonInit({message0:o.STORE_DELETE_MSG0,args0:[{type:"input_value",name:"KEY",check:"String"}],colour:r,output:null,tooltip:o.STORE_DELETE_TOOLTIP})}},i.JavaScript.store_delete=function(t){return[`spritly.runtime.Store.delete(${i.JavaScript.valueToCode(t,"KEY",i.JavaScript.ORDER_MEMBER)||"'key'"})`,i.JavaScript.ORDER_NONE]}},function(t,e,n){const i=n(0),o=i.Msg,r=o.SOUND_HUE;i.Blocks.sound_play={init(){this.jsonInit({message0:o.SOUND_PLAY_MSG0,args0:[{type:"input_value",name:"SOUND",check:"String"}],colour:r,previousStatement:"Statement",nextStatement:"Statement",tooltip:o.SOUND_PLAY_TOOLTIP})}},i.JavaScript.sound_play=function(t){return`spritly.runtime.Audio.play(${i.JavaScript.valueToCode(t,"SOUND",i.JavaScript.ORDER_NONE)});\n`}},function(t,e,n){const i=n(0),o=i.Msg;i.Blocks.procedures_mutatorarg.validator_=function(t){const e=i.Mutator.findParentWs(this.sourceBlock_.workspace);if(!(t=t.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,"")))return null;let n=e.getVariable(t,"");return n&&n.name!==t&&e.renameVarById(n.getId(),t),n||(n=e.createVariable(t,null,"ARGS$$"+Math.random().toString(36).slice(2)),n&&this.createdVariables_&&this.createdVariables_.push(n)),t},i.Blocks.procedures_defreturn.updateVarName=function(t){for(var e=t.name,n=!1,o=0;o<this.argumentVarModels_.length;o++)if(this.argumentVarModels_[o].getId()==t.getId()){var r=this.arguments_[o];this.arguments_[o]=e,n=!0}n&&(this.displayRenamedVar_(r,e),i.Procedures.mutateCallers(this))},i.Blocks.procedures_callreturn.setProcedureParameters_=function(t,e){var n=i.Procedures.getDefinition(this.getProcedureCall(),this.workspace),o=n&&n.mutator&&n.mutator.isVisible();if(o||(this.quarkConnections_={},this.quarkIds_=null),e)if(t.join("\n")!=this.arguments_.join("\n")){if(e.length!=t.length)throw RangeError("paramNames and paramIds must be the same length.");this.setCollapsed(!1),this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]);var r=this.rendered;this.rendered=!1;for(var _=0;_<this.arguments_.length;_++){var a=this.getInput("ARG"+_);if(a){var T=a.connection.targetConnection;this.quarkConnections_[this.quarkIds_[_]]=T,o&&T&&-1==e.indexOf(this.quarkIds_[_])&&(T.disconnect(),T.getSourceBlock().bumpNeighbours_())}}if(this.arguments_=[].concat(t),this.updateShape_(),this.quarkIds_=e,this.quarkIds_)for(_=0;_<this.arguments_.length;_++){var s=this.quarkIds_[_];if(s in this.quarkConnections_){T=this.quarkConnections_[s];i.Mutator.reconnect(T,this,"ARG"+_)||delete this.quarkConnections_[s]}}this.rendered=r,this.rendered&&this.render()}else this.quarkIds_=e},i.JavaScript.procedures_defreturn=function(t){var e=i.JavaScript.variableDB_.getName(t.getFieldValue("NAME"),i.Procedures.NAME_TYPE),n=i.JavaScript.statementToCode(t,"STACK");if(i.JavaScript.STATEMENT_PREFIX){var o=t.id.replace(/\$/g,"$$$$");n=i.JavaScript.prefixLines(i.JavaScript.STATEMENT_PREFIX.replace(/%1/g,"'"+o+"'"),i.JavaScript.INDENT)+n}i.JavaScript.INFINITE_LOOP_TRAP&&(n=i.JavaScript.INFINITE_LOOP_TRAP.replace(/%1/g,"'"+t.id+"'")+n);var r=i.JavaScript.valueToCode(t,"RETURN",i.JavaScript.ORDER_NONE)||"";r&&(r=i.JavaScript.INDENT+"return "+r+";\n");for(var _=[],a=0;a<t.arguments_.length;a++)_[a]=i.JavaScript.variableDB_.getName(t.arguments_[a],i.Variables.NAME_TYPE);var T="";this.isAsync_&&(T="async ",e=e.replace(/^⌛️/,""));var s=T+"function "+e+"("+_.join(", ")+") {\n"+n+r+"}";return s=i.JavaScript.scrub_(t,s),i.JavaScript.definitions_["%"+e]=s,null},i.Blocks.procedures_await={init(){this.jsonInit({message0:o.PROCEDURES_AWAIT_MSG0,args0:[{type:"input_value",name:"PROMISE"}],colour:o.PROCEDURE_HUE,output:null,tooltip:o.PROCEDURES_AWAIT_TOOLTIP})}},i.JavaScript.procedures_await=function(t){return[`(await ${i.JavaScript.valueToCode(t,"PROMISE",i.JavaScript.ORDER_NONE)||"null"})`,i.JavaScript.ORDER_NONE]},i.Blocks.procedures_call={init(){this.jsonInit({message0:"%1 %2",args0:[{type:"field_dropdown",name:"CALLTYPE",options:[[o.SPRITE_ANIMATE_OPTION_ASYNC_DEFAULT,"void"],[o.SPRITE_ANIMATE_OPTION_ASYNC_AWAIT,"await"]]},{type:"input_value",name:"PROC"}],colour:o.PROCEDURE_HUE,nextStatement:"Statement",previousStatement:"Statement"})}},i.JavaScript.procedures_call=function(t){return`${t.getFieldValue("CALLTYPE")} ${i.JavaScript.valueToCode(t,"PROC",i.JavaScript.ORDER_NONE)||"null"};\n`}},function(t,e,n){const i=n(0);i.Generator.prototype.indent=function(t){return this.prefixLines(t,this.INDENT)},i.JavaScript.init=function(t){i.JavaScript.definitions_=Object.create(null),i.JavaScript.functionNames_=Object.create(null),i.JavaScript.variableDB_?i.JavaScript.variableDB_.reset():i.JavaScript.variableDB_=new i.Names(i.JavaScript.RESERVED_WORDS_),i.JavaScript.variableDB_.setVariableMap(t.getVariableMap());const e=[],n=i.Variables.allDeveloperVariables(t);for(let t=0;t<n.length;t++)e.push(i.JavaScript.variableDB_.getName(n[t],i.Names.DEVELOPER_VARIABLE_TYPE));const o=i.Variables.allUsedVarModels(t).filter(t=>0!==t.getId().indexOf("ARGS$$"));for(let t=0;t<o.length;t++)e.push(i.JavaScript.variableDB_.getName(o[t].getId(),i.Variables.NAME_TYPE));e.length&&(i.JavaScript.definitions_.variables=`let ${e.join(", ")};`)},i.Generator.prototype.workspaceToCode=function(t){t||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),t=i.getMainWorkspace());let e=[];this.init(t);const n=t.getTopBlocks(!0);for(let t=0;t<n.length;t++){const i=n[t];let o=this.blockToCode(i);!i.disabled&&i.scope&&(Array.isArray(o)&&(o=o[0]),null!=o&&(""===o&&(o="void(0);\n"),i.outputConnection&&(o=this.scrubNakedValue(o)),"function"==typeof i.scope&&(o=i.scope(this,o)),e.push(o),e.push("\n")))}return e=e.slice(0,-1).join("\n"),e=this.finish(e),e=e.replace(/^\s+\n/,""),e=e.replace(/\n\s+$/,"\n"),e=e.replace(/[ \t]+\n/g,"\n"),e}},,function(t,e,n){"use strict";n.r(e),n.d(e,"Blockly",(function(){return l})),n.d(e,"Application",(function(){return E}));n(1),n(2);const i=n(0),{Msg:o}=i;o.$=(t,e="COMMON")=>{const n=`${e}_${t.toUpperCase()}`;return n in o?o[n]:t};n(3),n(4),n(5),n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13),n(14),n(15),n(16);function r(t){const e=t.querySelectorAll("next > block"),n=[];e.forEach(t=>{const e=t.parentNode.parentNode;t.parentNode.remove(),t.remove();(function(t){for(let e=0;e<n.length;e++){const i=n[e];if(i.has(t))return i}const e=new Set;return e.add(t),n.push(e),e})(e).add(t)}),n.forEach(t=>{const e=[...t],n=e[0].parentNode,i=document.createElement("blocks");n.insertBefore(i,e[0]),e[0].remove(),e.forEach(t=>i.appendChild(t))})}function _(t){t.querySelectorAll("blocks").forEach(t=>{const e=t.children[0];if(e){let n=e;const i=[...t.children];for(let t=1;t<i.length;t++){const e=i[t];e.remove();const o=document.createElement("next");o.appendChild(e),n.appendChild(o),n=e}e.remove(),t.parentNode.insertBefore(e,t),t.remove()}})}var a=async function(t="toolboxs/default.xml"){const e=await fetch(t).then(t=>t.text()).then(t=>(new DOMParser).parseFromString(t,"text/xml"));_(e);let n=e.querySelectorAll("externals module");return n=[...n].map(t=>t.getAttribute("src")),await Promise.all(n.map(t=>function(t){if(0!==t.indexOf("/")&&(t="/toolboxs/"+t),!document.querySelector(`script[src="${t}"]`)){const e=document.createElement("script"),n=new Promise(t=>{e.onload=()=>{t(e)}});return e.src=t,document.body.appendChild(e),n}return Promise.resolve()}(t))),{externals:n,toolbox:e.documentElement,toolboxSrc:t}};const T=n(0);function s(t,e){let n=t;do{n=n.getNextBlock(),n&&n.setCollapsed(e)}while(n)}T.BlockSvg.START_HAT=!0,T.Field.prototype.maxDisplayLength=20;var E=class{constructor(t){"string"==typeof t&&(t=document.getElementById(t)||document.querySelector(t)),this.container=t}async initWorkspace(t){this.workspace&&this.workspace.dispose();const{config:e}=t;delete t.config;const{externals:n,toolbox:i,toolboxSrc:o,blockXml:r,preload_res:E,scriptsBefore:l,scriptsAfter:c}=await async function(t="index.xml"){0!==t.indexOf("/")&&(t="/blocks/"+t),/xml$/.test(t)||(t+=".xml");const e=await fetch(t).then(t=>t.text()).then(t=>(new DOMParser).parseFromString(t,"text/xml")),n=e.documentElement.getAttribute("toolbox")||"toolboxs/default.xml",{externals:i,toolbox:o}=await a(n),r=Array.from(e.querySelectorAll("preload resource")).map(t=>{if("texture_packer"===t.getAttribute("type")){return[t.getAttribute("texture"),t.getAttribute("data")]}const e=t.getAttribute("src");return{id:t.getAttribute("id")||e,src:e}}),T=[],s=[];let E=T;const l=e.documentElement.children;for(let t=0;t<l.length;t++){const e=l[t];if("script"===e.tagName.toLowerCase()){const t=e.getAttribute("src");if(t){const e=await fetch(t).then(t=>t.text());E.push({code:e,src:t})}}else"block"===e.tagName.toLowerCase()&&(E=s)}return _(e),{externals:i,toolbox:o,toolboxSrc:n,blockXml:e,preload_res:r,scriptsBefore:T,scriptsAfter:s}}(e);t.toolbox=i,this.toolboxSrc=o,this.preload_res=E,this.externals=n,this.scriptsBefore=l,this.scriptsAfter=c;const O=T.inject(this.container,t);T.Xml.domToWorkspace(r.documentElement,O),O.getAllBlocks().forEach(t=>{if(!t.getParent()){t.isCollapsed()&&s(t,!0)}});let S=null;O.addChangeListener(t=>{if(t.type===T.Events.UI&&"click"===t.element){const e=Date.now();if(S&&e-S<=300){S=null;const e=O.getBlockById(t.blockId),n=e.isCollapsed();e.getParent()||s(e,!n),e.setCollapsed(!n)}S=e}if(t.type===T.Events.CHANGE&&"collapsed"===t.element){const e=O.getBlockById(t.blockId);if(!e.getParent()){s(e,t.newValue)}}});const p=t=>{if(t instanceof T.Events.Change){const e=t.blockId;let n;t.workspaceId===O.id?n=O.getBlockById(e):O.toolboxWorkspace&&t.workspaceId===O.toolboxWorkspace.id&&(n=O.toolboxWorkspace.getBlockById(e)),n&&n.updated&&(n.oldValue_||(n.oldValue_=t.oldValue),clearTimeout(n.changeIdTimer_),n.changeIdTimer_=setTimeout(()=>{const e=n.oldValue_;delete n.oldValue_,t.oldValue=e,n.updated(t)},500))}else if(t instanceof T.Events.Create){const e=t.blockId;let n;t.workspaceId===O.id?n=O.getBlockById(e):O.toolboxWorkspace&&t.workspaceId===O.toolboxWorkspace.id&&(n=O.toolboxWorkspace.getBlockById(e)),n.created&&n.created(t);n.getAllDescendants().forEach(e=>{e.created&&e.created(t)})}};O.addChangeListener(p);const R=O.toolboxWorkspace;return R&&R.addChangeListener(p),this.workspace=O,O}get xml(){if(!this.workspace)return"";const{workspace:t,preload_res:e,scriptsBefore:n,scriptsAfter:i,toolboxSrc:o,externals:_}=this,a=T.Xml.workspaceToDom(t);r(a);let s=a.innerHTML;if(e){const t=[];e.forEach(e=>{Array.isArray(e)?t.push(`<resource type="texture_packer" texture="${e[0]}" data="${e[1]}"/>`):e.id===e.src?t.push(`<resource type="image" src="${e.src}"/>`):t.push(`<resource type="image" src="${e.src}" id="${e.id}"/>`)}),s=`<preload>${t.join("")}</preload>${s}`}if(n&&(s=`${n.map(({src:t})=>`<script src="${t}"/>`).join("")}${s}`),i&&(s=`${s}${i.map(({src:t})=>`<script src="${t}"/>`).join("")}`),_){s=`<externals>${_.map(t=>`<module src="${t}"/>`).join("")}</externals>${s}`}s=`<xml toolbox="${o}">${s}</xml>`;let E=0;return s.replace(/></g,">\n<").split(/\n/g).map(t=>{let e=t;return/^<\//.test(t)&&(E-=2),E>0&&(e=`${new Array(E+1).join(" ")}${t}`),/(<\/\w+>|\/>)$/.test(t)||(E+=2),e}).join("\n")}get code(){if(!this.workspace)return"";const{workspace:t,preload_res:e,scriptsBefore:n,scriptsAfter:i}=this,o=(T.Xml.workspaceToDom(t),[]);window.LoopTrap=1e7,T.JavaScript.INFINITE_LOOP_TRAP=T.Generator.prototype.INDENT+'if (--window.LoopTrap == 0) throw "Infinite loop.";\n',T.JavaScript.init(t);const r=T.JavaScript.workspaceToCode(t);o.push(r),T.JavaScript.INFINITE_LOOP_TRAP=null,e?o.push(`spritly.runtime.scene.preload(...${JSON.stringify(e)})\n  .then(() => spritly.runtime.Signal.send('START', spritly.runtime.scene));\n`):o.push("spritly.runtime.Signal.send('START', spritly.runtime.scene);\n");const _=`/** \n  Generated by spritly ${(new Date).toLocaleString()};\n  Usage: \n  <script src="https://unpkg.com/spritejs/dist/spritejs.min.js"><\/script>\n  <script src="https://unpkg.com/spritly/dist/spritly-runtime.min.js"><\/script>\n  <div id="stage" style="width:100%;height:100%;"></div>\n*/`;return o.unshift(_,"spritly.runtime.use(spritejs);"),n.length&&o.unshift("/* -- external scripts start -- */",...n.map(({code:t})=>t),"/* -- external scripts end -- */"),i.length&&o.push("/* -- external scripts start -- */",...i.map(({code:t})=>t),"/* -- external scripts end -- */"),o.join("\n\n")}};const l=n(0);l.BlockSvg.START_HAT=!0,l.Field.prototype.maxDisplayLength=20;const c=l.Block.prototype.dispose;l.Block.prototype.dispose=function(...t){return this.destroyed&&this.destroyed(),c.apply(this,t)},l.Workspace.prototype.getBlocksByType=function(t){return this.getAllBlocks().filter(e=>e.type===t)},Object.defineProperty(l.Workspace.prototype,"toolboxWorkspace",{get(){const t=this.getFlyout_();return t?t.workspace_:null}}),l.Block.prototype.getAllDescendants=function(){return function t(e){const n=e.getChildren();return n?n.reduce((e,n)=>[...e,...t(n)],[e]):[e]}(this).slice(1)}}]);